{"ast":null,"code":"import _regeneratorRuntime from \"/home/pandi95/Projects/React/blog-frontend/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/pandi95/Projects/React/blog-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { set, remove } from \"../../services/utils/storage\";\nimport { apiRegister, apiLogin, apiGetProfile } from \"../../services/auth/registerService\";\nimport { FETCH_AUTH, RECEIVE_AUTH, FAILED_AUTH, FETCH_LOGOUT_USER } from \"../types\";\nimport { FOODCOURT_SELECTED } from \"../../constants\";\n\nvar fetch = function fetch() {\n  return {\n    type: FETCH_AUTH\n  };\n};\n\nvar receive = function receive(data) {\n  return {\n    type: RECEIVE_AUTH,\n    payload: {\n      currentItem: data\n    }\n  };\n};\n\nvar logout = function logout() {\n  return {\n    type: FETCH_LOGOUT_USER\n  };\n};\n\nvar failed = function failed(error) {\n  return {\n    type: FAILED_AUTH,\n    payload: {\n      error: typeof error === 'object' ? error.message : error\n    }\n  };\n}; // Register User\n\n\nvar registerUser = function registerUser(data) {\n  return /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              dispatch(fetch());\n              _context.next = 4;\n              return apiRegister(data);\n\n            case 4:\n              response = _context.sent;\n\n              if (!(response && response.success)) {\n                _context.next = 11;\n                break;\n              }\n\n              dispatch(receive(response.data));\n\n              if (!(response && response.data)) {\n                _context.next = 9;\n                break;\n              }\n\n              return _context.abrupt(\"return\", response);\n\n            case 9:\n              _context.next = 13;\n              break;\n\n            case 11:\n              dispatch(failed(response));\n              return _context.abrupt(\"return\", response);\n\n            case 13:\n              _context.next = 19;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](0);\n              dispatch(failed(_context.t0));\n              return _context.abrupt(\"return\", _context.t0);\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 15]]);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n}; // Login\n\n\nvar loginUser = function loginUser(data) {\n  var guard = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'user';\n  return /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              dispatch(fetch());\n              _context2.next = 4;\n              return apiLogin(data);\n\n            case 4:\n              response = _context2.sent;\n              console.log('Login Data ', response, guard);\n\n              if (!(response && response.success)) {\n                _context2.next = 16;\n                break;\n              }\n\n              dispatch(receive(response.data));\n\n              if (!(response && response.data)) {\n                _context2.next = 14;\n                break;\n              }\n\n              _context2.next = 11;\n              return set(\"access_token_\".concat(guard), response.data.access_token);\n\n            case 11:\n              _context2.next = 13;\n              return set(\"refresh_token_\".concat(guard), response.data.refresh_token);\n\n            case 13:\n              return _context2.abrupt(\"return\", response);\n\n            case 14:\n              _context2.next = 18;\n              break;\n\n            case 16:\n              dispatch(failed(response));\n              return _context2.abrupt(\"return\", response);\n\n            case 18:\n              _context2.next = 24;\n              break;\n\n            case 20:\n              _context2.prev = 20;\n              _context2.t0 = _context2[\"catch\"](0);\n              dispatch(failed(_context2.t0));\n              return _context2.abrupt(\"return\", _context2.t0);\n\n            case 24:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 20]]);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n}; // Logout\n\n\nvar logoutUser = function logoutUser(guard) {\n  return /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return remove(\"access_token_\".concat(guard));\n\n            case 2:\n              _context3.next = 4;\n              return remove(\"refresh_token_\".concat(guard));\n\n            case 4:\n              if (!(guard === 'owner')) {\n                _context3.next = 7;\n                break;\n              }\n\n              _context3.next = 7;\n              return remove(FOODCOURT_SELECTED);\n\n            case 7:\n              dispatch(logout());\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function (_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n}; // Get user token\n\n\nvar getUserData = function getUserData(guard) {\n  return /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              console.log('USER TOKEN ', guard);\n              _context4.next = 3;\n              return apiGetProfile(guard);\n\n            case 3:\n              response = _context4.sent;\n\n              if (!response.success) {\n                _context4.next = 7;\n                break;\n              }\n\n              dispatch(receive(response.data));\n              return _context4.abrupt(\"return\", response);\n\n            case 7:\n              _context4.next = 9;\n              return remove(\"access_token_\".concat(guard));\n\n            case 9:\n              _context4.next = 11;\n              return remove(\"refresh_token_\".concat(guard));\n\n            case 11:\n              dispatch(failed(response));\n              return _context4.abrupt(\"return\", response);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function (_x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n};\n\nexport { registerUser, loginUser, logoutUser, getUserData };","map":null,"metadata":{},"sourceType":"module"}